version: '3.8'

services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile.gpu
    ports:
      - "8000:8000"
    volumes:
      - ./backend:/app:delegated
    environment:
      - ENVIRONMENT=development
      - SIGLIP_LOCAL_DIR=/app/models/siglip
      - FLORENCE_LOCAL_DIR=/app/models/florence2
      - API_KEY=${API_KEY:-dev-secret}
      - CORS_ALLOWED_ORIGINS=${CORS_ALLOWED_ORIGINS:-*}
    # When running with docker run use: --gpus all
    deploy:
      resources:
        reservations:
          devices:
            - capabilities: [gpu]
